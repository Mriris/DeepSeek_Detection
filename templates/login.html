{% extends 'base.html' %}

{% block content %}
<meta charset="utf-8">
<title>登录</title>
<section id="hero" class="hero section light-background" style="background-color: #d3e7fb">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-6 col-lg-4">
                <div class="login-container" style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 0 15px rgba(0,0,0,0.1); margin: 40px auto;">
                    <div class="text-center mb-4">
                        <h2><strong>账号登录</strong></h2>
                    </div>
                    <form id="loginForm">
                        <input type="text" placeholder="请输入账号" id="username" autocomplete="off" style="width: 100%; margin-bottom: 15px; padding: 10px; border: 1px solid #ddd; border-radius: 4px;"/><br>
                        <input type="password" placeholder="请输入密码" id="passwd" autocomplete="off" style="width: 100%; margin-bottom: 15px; padding: 10px; border: 1px solid #ddd; border-radius: 4px;"/><br>
                        <input style="width: 100%; height: 50px; background:#409ecd; border:0px; color:#fff; border-radius:4px; font-size:16px; padding: 0; cursor: pointer;" type="button" value="登录" onclick="checkLogin()">
                        <div style="margin-top: 15px; text-align: right;">
                            <a href="/register" style="text-decoration: none; color: #409ecd;">没有账号？点击注册</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    function checkLogin() {
        const username = document.getElementById('username').value;
        const password = document.getElementById('passwd').value;

        // 前端基本验证
        if (!username || !password) {
            alert('请输入用户名和密码');
            return;
        }

        // 使用 fetch API 发送请求到后端
        fetch('/check_login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                username: username,
                password: password
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // 登录成功，将用户名作为参数添加到跳转的 URL 中
                window.location.href = `/detective`;
            } else {
                alert(data.message || '账号或密码错误，请重试！');
            }
        })
        .catch(error => {
            console.error('登录请求出错:', error);
            alert('登录请求失败，请稍后再试');
        });
    }
</script>
{% endblock %}
