{% extends 'base.html' %}

{% block content %}
<!-- Hero Section -->
<section id="hero" class="hero section dark-background">
    <div class="container">
        <!-- 页面标题 -->
        <div class="page-header mb-4">
            <h2><i class="bi bi-shield-check"></i> 漏洞检测平台</h2>
            <p class="text-muted">上传可执行文件进行安全分析</p>
        </div>
        <div class="row gy-4">
            <!-- 左侧，上传文件和操作按钮 -->
            <div class="col-lg-7 order-2 order-lg-1 d-flex flex-column justify-content-center" data-aos="zoom-out">
                <h1 style="font-size: 48px; color: #37517e">Scanix</h1>
                <p style="font-size: 24px; color: #444444">通过深度学习模型分析代码中的潜在安全漏洞</p>

                <!-- 文件上传表单 -->
                <form action="/detect" method="POST" enctype="multipart/form-data" id="detect-form"
                      class="upload-form d-flex flex-column align-items-center justify-content-center">
                    <div class="form-group w-100 d-flex">
                        <input type="file" name="bin_file" id="bin-upload" accept=".bin, .exe, .elf"
                               class="form-control w-50">
                    </div>
                    
                    <!-- 添加模型选择下拉菜单 -->
                    <div class="form-group w-100 mt-2">
                        <label for="model-select" class="form-label">选择分析模型:</label>
                        <div class="d-flex">
                            <select name="model_name" id="model-select" class="form-select me-2">
                                {% if models %}
                                    <optgroup label="已训练模型">
                                    {% for model in models %}
                                        {% if model.type == 'trained' %}
                                        <option value="{{ model.name }}">{{ model.name }} (基于 {{ model.base_model }})</option>
                                        {% endif %}
                                    {% endfor %}
                                    </optgroup>
                                    
                                    <optgroup label="基础模型">
                                    {% for model in models %}
                                        {% if model.type == 'base' %}
                                        <option value="{{ model.name }}">{{ model.name }}</option>
                                        {% endif %}
                                    {% endfor %}
                                    </optgroup>
                                {% else %}
                                    <option value="deepseek-r1:14b">deepseek-r1:14b</option>
                                {% endif %}
                            </select>
                            <button type="button" id="refresh-models-btn" class="btn btn-outline-primary" 
                                    onclick="refreshModelsList()" title="刷新模型列表">
                                <i class="bi bi-arrow-clockwise"></i>
                            </button>
                        </div>
                    </div>
                </form>
                <!-- 按钮 -->
                <div class="d-flex mt-3">
                    <a href="javascript:void(0);" class="btn-get-started me-3" id="action-btn">上传</a>
                </div>
            </div>
            <!-- 右侧，示意图（可以用任何展示漏洞检测结果的图像或保留默认） -->
            <div class="col-lg-5 order-1 order-lg-2 hero-img" data-aos="zoom-out" data-aos-delay="200">
                <img id="image-display" src="../static/assets/img/hero-img.png" class="img-fluid animated"
                     style="margin-left: -50px;"
                     alt="示意图">
                <!-- 增强后的图像，默认隐藏，改为显示检测结果 -->
                <img id="enhanced-image-display" src="" style="margin-left: 20px;" class="img-fluid animated d-none"
                     alt="检测结果">
            </div>

        </div>
        <!-- 加载动画 -->
        <div id="loading-animation" style="display: none;">
            <div class="spinner"></div>
            <p style="font-size: 20px;; color: #0a53be">正在检测，请稍候...</p>
        </div>
        <!-- 显示检测结果 -->
        <div id="detection-result" style="margin-top: 20px; color: #292d35;"></div>
        <!-- 显示漏洞分析结果 -->
        <div id="analysis-result" style="margin-top: 20px; color: #533981;"></div>
    </div>
</section><!-- /Hero Section -->

<script>
    // 移除重复的声明
    // let currentStep = 'select';
    // let resultData = [];  // 用于保存检测结果数据

    let currentStep = 'select';
    let resultData = [];  // 用于保存检测结果数据
    let dangerLevelData = []; // 用于保存危险程度数据
    
    // 刷新模型列表
    function refreshModelsList() {
        const refreshBtn = document.getElementById('refresh-models-btn');
        const modelSelect = document.getElementById('model-select');
        
        // 添加加载动画
        refreshBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>';
        refreshBtn.disabled = true;
        
        fetch('/api/ollama/models?include_trained=true')
            .then(response => response.json())
            .then(data => {
                if (data.models && Array.isArray(data.models)) {
                    // 清空现有选项
                    modelSelect.innerHTML = '';
                    
                    // 分组添加选项
                    const trainedModels = data.models.filter(model => model.type === 'trained');
                    const baseModels = data.models.filter(model => model.type === 'base');
                    
                    // 添加训练模型组
                    if (trainedModels.length > 0) {
                        const trainedGroup = document.createElement('optgroup');
                        trainedGroup.label = '已训练模型';
                        
                        trainedModels.forEach(model => {
                            const option = document.createElement('option');
                            option.value = model.name;
                            option.textContent = `${model.name} (基于 ${model.base_model})`;
                            trainedGroup.appendChild(option);
                        });
                        
                        modelSelect.appendChild(trainedGroup);
                    }
                    
                    // 添加基础模型组
                    if (baseModels.length > 0) {
                        const baseGroup = document.createElement('optgroup');
                        baseGroup.label = '基础模型';
                        
                        baseModels.forEach(model => {
                            const option = document.createElement('option');
                            option.value = model.name;
                            option.textContent = model.name;
                            baseGroup.appendChild(option);
                        });
                        
                        modelSelect.appendChild(baseGroup);
                    }
                    
                    console.log(`已更新模型列表，共 ${data.models.length} 个模型`);
                } else {
                    console.error('获取模型列表失败');
                }
            })
            .catch(error => {
                console.error('刷新模型列表时出错:', error);
                alert('刷新模型列表失败，请稍后再试');
            })
            .finally(() => {
                // 恢复按钮状态
                refreshBtn.innerHTML = '<i class="bi bi-arrow-clockwise"></i>';
                refreshBtn.disabled = false;
            });
    }

    document.getElementById('action-btn').addEventListener('click', function (event) {
        event.preventDefault();

        if (currentStep === 'select') {
            handleFileUpload();
        } else if (currentStep === 'detect') {
            // 如果选中了地址，调用漏洞分析
            if (selectedAddress) {
                document.getElementById('loading-animation').style.display = 'block';
                analyzeVulnerability(selectedAddress);
            }
        } else if (currentStep === 'reset') {
            resetPage();
        }
    });


    // 启动检测
    function startDetection() {
        const formData = new FormData(document.getElementById('detect-form'));
        
        // 记录选择的模型
        const modelSelect = document.getElementById('model-select');
        const selectedModel = modelSelect ? modelSelect.value : 'deepseek-r1:14b';
        console.log("选择使用模型:", selectedModel);

        // 显示加载动画
        document.getElementById('loading-animation').style.display = 'block';
        document.getElementById('action-btn').disabled = true;  // 禁用按钮，防止重复点击

        fetch('/detect', {
            method: 'POST',
            body: formData
        })
            .then(response => response.json())
            .then(data => {
                console.log("收到的完整数据:", data);

                // 隐藏加载动画并启用按钮
                document.getElementById('loading-animation').style.display = 'none';
                document.getElementById('action-btn').disabled = false;  // 启用按钮

                if (data.error) {
                    console.error("错误:", data.error);
                    alert(data.error || "发生了未知错误");
                } else {
                    let csvData = data.csv;
                    console.log("收到的 csv 数据:", csvData);

                    if (!Array.isArray(csvData)) {
                        console.error("data.csv 不是数组，数据格式错误");
                        alert("数据格式错误");
                        return;
                    }
                    // 将结果保存在 data 中并显示表格
                    resultData = csvData;
                    displayResults(resultData);
                    document.getElementById('action-btn').textContent = '请选择漏洞';
                }
            })
            .catch(error => {
                // 隐藏加载动画并启用按钮
                document.getElementById('loading-animation').style.display = 'none';
                document.getElementById('action-btn').disabled = false;  // 启用按钮
                console.error('检测过程中出错:', error);
                alert('检测过程中出错，请稍后再试');
            });
    }


    function analyzeVulnerability(address) {
        console.log("开始分析漏洞:", address);
        
        // 获取选择的模型
        const modelSelect = document.getElementById('model-select');
        const selectedModel = modelSelect ? modelSelect.value : 'deepseek-r1:14b';
        console.log("使用模型:", selectedModel);

        fetch(`/analyze/${address}?model_name=${selectedModel}`, {
            method: 'GET'
        })
            .then(response => {
                if (!response.ok) {
                    // 如果状态码不是 200，抛出错误
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                document.getElementById('loading-animation').style.display = 'none';
                if (data.error) {
                    console.error("分析失败:", data.error);
                    alert("分析失败");
                } else {
                    console.log("分析结果:", data.result);
                    // 提取 <think> 和外部 Markdown 内容
                    let resultContent = data.result;
                    let thinkStartIndex = resultContent.indexOf('<think>');
                    let thinkEndIndex = resultContent.indexOf('</think>');

                    // 提取 think 内容
                    let thinkContent = '';
                    let markdownContent = '';

                    if (thinkStartIndex !== -1 && thinkEndIndex !== -1) {
                        thinkContent = resultContent.slice(thinkStartIndex + 7, thinkEndIndex); // 去除 <think> 和 </think>
                        markdownContent = resultContent.slice(thinkEndIndex + 8).trim(); // 获取 think 后面的内容
                    } else {
                        markdownContent = resultContent; // 如果没有 <think> 标签，直接显示结果
                    }

                    // 预处理markdown内容，分离不同部分
                    const sections = processMarkdownContent(markdownContent);
                    
                    // 更新分析结果区域
                    document.getElementById('analysis-result').innerHTML = `
                    <section id="vulnerability-analysis" class="section light-background" data-aos="fade-up">
                        <div class="container">
                            <div class="row justify-content-center">
                                <div class="col-lg-10">
                                    <!-- 标题部分 -->
                                    <div class="text-center mb-5">
                                        <h2 class="fw-bold" style="color: #37517e; margin-bottom: 20px;">
                                            <i class="bi bi-shield-exclamation"></i> 漏洞分析结果
                                        </h2>
                                        <div class="divider-custom">
                                            <div class="divider-custom-line"></div>
                                            <div class="divider-custom-icon"><i class="bi bi-code-slash"></i></div>
                                            <div class="divider-custom-line"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- 概述卡片 -->
                                    <div class="card mb-4 shadow-sm border-0">
                                        <div class="card-header bg-primary text-white py-3">
                                            <h3 class="m-0 fw-bold"><i class="bi bi-info-circle"></i> 漏洞概述</h3>
                                        </div>
                                        <div class="card-body p-4">
                                            <div class="vulnerability-summary">
                                                ${sections.summary || ''}
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- 漏洞详情卡片组 -->
                                    <div id="vulnerability-details">
                                        ${sections.details}
                                    </div>
                                    
                                    <!-- 修复建议卡片 -->
                                    <div class="card mb-4 shadow-sm border-0">
                                        <div class="card-header bg-success text-white py-3">
                                            <h3 class="m-0 fw-bold"><i class="bi bi-wrench"></i> 修复建议</h3>
                                        </div>
                                        <div class="card-body p-4">
                                            <div class="solution">
                                                ${sections.solution || '未提供修复建议'}
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- 分析模型信息 -->
                                    <div class="card mb-4 shadow-sm border-0 bg-light">
                                        <div class="card-body p-3">
                                            <small class="text-muted">
                                                <i class="bi bi-cpu"></i> 由 <strong>${selectedModel}</strong> 模型分析
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                    `;
                }
            })
            .catch(error => {
                console.error("分析时出错:", error);
                alert("分析时出错，请稍后再试");
            });
    }

    // 处理Markdown内容，将其分解为不同的部分
    function processMarkdownContent(markdown) {
        // 默认结果结构
        const result = {
            summary: '',
            details: '',
            solution: ''
        };
        
        try {
            // 处理漏洞详情部分 - 提取指令和相关信息
            const instructionBlocks = [];
            const instructionRegex = /指令\s+\d+:\s+([^\n]+)(?:[\s\S]*?)(?=指令\s+\d+:|$)/g;
            let match;
            
            while ((match = instructionRegex.exec(markdown)) !== null) {
                const block = match[0];
                
                // 提取问题(Issue)
                let issue = '';
                const issueMatch = block.match(/Issue:\s*([^\n]+)/);
                if (issueMatch) issue = issueMatch[1];
                
                // 提取优先级(Priority)
                let priority = '';
                let priorityClass = 'bg-info'; // 默认颜色
                const priorityMatch = block.match(/Priority:\s*([^\n]+)/);
                if (priorityMatch) {
                    priority = priorityMatch[1].trim();
                    if (priority.toLowerCase().includes('high')) {
                        priorityClass = 'bg-danger';
                    } else if (priority.toLowerCase().includes('medium')) {
                        priorityClass = 'bg-warning';
                    } else if (priority.toLowerCase().includes('low')) {
                        priorityClass = 'bg-success';
                    }
                }
                
                // 提取潜在漏洞(Potential Vulnerability)
                let vulnerability = '';
                const vulnMatch = block.match(/Potential Vulnerability:\s*([^\n]+[\s\S]*?)(?=\s*Issue:|Priority:|$)/);
                if (vulnMatch) vulnerability = vulnMatch[1];
                
                // 构建卡片HTML
                instructionBlocks.push(`
                    <div class="card mb-4 shadow-sm border-0 instruction-card">
                        <div class="card-header ${priorityClass}">
                            <h4 class="m-0 d-flex align-items-center">
                                <i class="bi bi-exclamation-triangle me-2 text-white"></i> 
                                <span class="instruction-title text-white" style="text-shadow: 0 1px 2px rgba(0,0,0,0.5);">${match[1]}</span>
                                <span class="ms-auto badge bg-light text-dark" style="font-weight: 700;">${priority}</span>
                            </h4>
                        </div>
                        <div class="card-body p-4">
                            <div class="mb-3">
                                <h5 class="text-danger fw-bold">
                                    <i class="bi bi-bug"></i> 问题
                                </h5>
                                <p class="text-dark fw-medium">${issue}</p>
                            </div>
                            
                            <div class="mb-3">
                                <h5 class="text-primary fw-bold">
                                    <i class="bi bi-shield"></i> 潜在漏洞
                                </h5>
                                <p class="text-dark fw-medium">${vulnerability}</p>
                            </div>
                        </div>
                    </div>
                `);
            }
            
            // 组合所有指令块
            result.details = instructionBlocks.join('');
            if (!result.details) {
                // 如果没有提取到结构化内容，使用标准markdown渲染
                result.details = `
                <div class="card mb-4 shadow-sm border-0">
                    <div class="card-header bg-info text-white py-3">
                        <h3 class="m-0 fw-bold"><i class="bi bi-list-ul"></i> 详细分析</h3>
                    </div>
                    <div class="card-body p-4">
                        ${marked(markdown)}
                    </div>
                </div>`;
            }
            
            // 提取总结/概述（假设是markdown开头的部分，直到第一个"指令"出现）
            const summaryMatch = markdown.match(/^([\s\S]*?)(?=指令\s+\d+:|$)/);
            if (summaryMatch && summaryMatch[1].trim()) {
                result.summary = marked(summaryMatch[1]);
            }
            
            // 提取解决方案（假设在最后一个instruction后，或包含"解决方案"/"修复建议"等关键词的段落）
            const solutionMatch = markdown.match(/(?:解决方案|修复建议|建议|解决办法)([\s\S]*?)$/i);
            if (solutionMatch) {
                result.solution = marked(solutionMatch[1] || solutionMatch[0]);
            }
            
            return result;
        } catch(e) {
            console.error("处理Markdown内容时出错:", e);
            // 发生错误时，返回原始markdown内容
            return {
                summary: '',
                details: `<div class="card mb-4"><div class="card-body">${marked(markdown)}</div></div>`,
                solution: ''
            };
        }
    }

    function displayResults(data) {
        // 生成表格 HTML，其中在 <tfoot> 中添加了输入框
        let tableHTML = `
        <div class="card shadow-sm border-0 mb-4">
            <div class="card-header bg-primary">
                <h3 class="m-0 text-white" style="font-weight: 800; text-shadow: 0 2px 4px rgba(0,0,0,0.5); color: #ffffff !important;"><i class="bi bi-bug" style="color: #ffffff !important;"></i> 检测到的漏洞</h3>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table id="results-table" class="table table-striped table-hover mb-0">
                        <thead class="table-dark">
                            <tr>
                                <th class="text-white">选择</th>
                                <th class="text-white">漏洞名称</th>
                                <th class="text-white">函数名称</th>
                                <th class="text-white">出现位置</th>
                                <th class="text-white">地址</th>
                                <th class="text-white">危险程度</th>
                            </tr>
                        </thead>
                        <tbody>
    `;
        data.forEach((item, index) => {
            // 根据优先级设置行的类
            let rowClass = '';
            let badgeClass = 'bg-info';
            
            if (item.Priority.toLowerCase().includes('high')) {
                rowClass = 'table-danger';
                badgeClass = 'bg-danger';
            } else if (item.Priority.toLowerCase().includes('medium')) {
                rowClass = 'table-warning';
                badgeClass = 'bg-warning text-dark';
            } else if (item.Priority.toLowerCase().includes('low')) {
                rowClass = 'table-success';
                badgeClass = 'bg-success';
            }
            
            tableHTML += `
            <tr class="${rowClass}">
                <td>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="vulfi-row" value="${item.Address}"
                         onclick="selectRow('${item.Address}')">
                  </div>
                </td>
                <td>${item.IssueName}</td>
                <td><code>${item.FunctionName}</code></td>
                <td>${item.FoundIn}</td>
                <td><code>${item.Address}</code></td>
                <td><span class="badge ${badgeClass}">${item.Priority}</span></td>
            </tr>
        `;
        });
        tableHTML += `
                    </tbody>
                    <tfoot>
                        <tr>
                            <th></th>
                            <th><input type="text" class="form-control form-control-sm" placeholder="筛选漏洞名称" /></th>
                            <th><input type="text" class="form-control form-control-sm" placeholder="筛选函数名称" /></th>
                            <th></th>
                            <th></th>
                            <th><input type="text" class="form-control form-control-sm" placeholder="筛选优先级" /></th>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>
    `;
        document.getElementById('detection-result').innerHTML = tableHTML;

        // 如果之前已经初始化过 DataTable，则先销毁
        if ($.fn.DataTable.isDataTable('#results-table')) {
            $('#results-table').DataTable().destroy();
        }

        // 初始化 DataTable
        let table = $('#results-table').DataTable({
            paging: true,       // 启用分页
            ordering: true,     // 启用排序
            info: true,         // 显示页脚信息
            language: {
                search: "搜索:",
                lengthMenu: "显示 _MENU_ 条记录",
                info: "显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项",
                infoEmpty: "显示第 0 至 0 项结果，共 0 项",
                infoFiltered: "(由 _MAX_ 项结果过滤)",
                paginate: {
                    first: "首页",
                    previous: "上页",
                    next: "下页",
                    last: "末页"
                }
            },
            columnDefs: [
                {orderable: false, targets: 0}  // 禁止第一列排序
            ]
        });

        // 针对每一列的筛选
        $('#results-table tfoot th').each(function (i) {
            // 如果当前列的 tfoot 单元格中存在 input 元素
            let input = $(this).find('input');
            if (input.length > 0) {
                input.on('keyup change clear', function () {
                    if (table.column(i).search() !== this.value) {
                        table.column(i).search(this.value).draw();
                    }
                });
            }
        });
        
        // 添加结果统计
        const highCount = data.filter(item => item.Priority.toLowerCase().includes('high')).length;
        const mediumCount = data.filter(item => item.Priority.toLowerCase().includes('medium')).length;
        const lowCount = data.filter(item => item.Priority.toLowerCase().includes('low')).length;
        
        // 在表格前添加统计信息
        const summaryHTML = `
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card shadow-sm border-0 bg-danger">
                    <div class="card-body text-center p-4">
                        <h3 class="mb-2 text-white" style="font-size: 2.8rem; font-weight: 800; text-shadow: 0 2px 4px rgba(0,0,0,0.6);">${highCount}</h3>
                        <p class="mb-0 text-white" style="font-size: 1.25rem; font-weight: 700; letter-spacing: 1px; text-shadow: 0 1px 3px rgba(0,0,0,0.5);">高危漏洞</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card shadow-sm border-0 bg-warning">
                    <div class="card-body text-center p-4">
                        <h3 class="mb-2 text-white" style="font-size: 2.8rem; font-weight: 800; text-shadow: 0 2px 4px rgba(0,0,0,0.6);">${mediumCount}</h3>
                        <p class="mb-0 text-white" style="font-size: 1.25rem; font-weight: 700; letter-spacing: 1px; text-shadow: 0 1px 3px rgba(0,0,0,0.5);">中危漏洞</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card shadow-sm border-0 bg-success">
                    <div class="card-body text-center p-4">
                        <h3 class="mb-2 text-white" style="font-size: 2.8rem; font-weight: 800; text-shadow: 0 2px 4px rgba(0,0,0,0.6);">${lowCount}</h3>
                        <p class="mb-0 text-white" style="font-size: 1.25rem; font-weight: 700; letter-spacing: 1px; text-shadow: 0 1px 3px rgba(0,0,0,0.5);">低危漏洞</p>
                    </div>
                </div>
            </div>
        </div>
        `;
        
        // 将统计信息添加到表格前
        document.getElementById('detection-result').insertAdjacentHTML('afterbegin', summaryHTML);
    }


    let selectedAddress = null;

    // 监听单选框的选择，确保按钮状态正确
    function selectRow(address) {
        selectedAddress = address;  // 更新选中的 address
        console.log("选中的地址是:", selectedAddress);
        document.getElementById('action-btn').textContent = '漏洞分析';  // 更新按钮文本
        // 如果选中某一行，按钮改名
        if (currentStep !== 'detect') {
            currentStep = 'detect';  // 设置状态为 detect，表示可以开始检测
        }
    }


    // 处理文件上传并显示上传的文件
    function handleFileUpload() {
        const fileInput = document.getElementById('bin-upload');
        const file = fileInput.files[0];

        if (file) {
            // 显示上传的文件名
            const reader = new FileReader();
            reader.onload = function (e) {
                document.getElementById('file-name').textContent = "已选择文件: " + file.name;
            };
            reader.readAsDataURL(file);

            // 修改按钮为"开始检测"，并直接开始检测
            document.getElementById('action-btn').textContent = '漏洞检测中';
            currentStep = 'detect';  // 更新按钮状态

            startDetection();  // 立即开始检测
        } else {
            alert("请选择一个文件进行上传！");
        }
    }


    // 刷新页面
    function resetPage() {
        window.location.reload();  // 通过重载页面实现"重置"
    }

    // 页面加载完成后，检查URL参数是否有预选模型
    document.addEventListener('DOMContentLoaded', function() {
        const urlParams = new URLSearchParams(window.location.search);
        const preSelectedModel = urlParams.get('model');
        
        if (preSelectedModel) {
            const modelSelect = document.getElementById('model-select');
            
            // 遍历所有选项查找匹配的模型
            let found = false;
            for (let i = 0; i < modelSelect.options.length; i++) {
                if (modelSelect.options[i].value === preSelectedModel) {
                    modelSelect.selectedIndex = i;
                    found = true;
                    break;
                }
            }
            
            // 如果没找到，可能需要刷新模型列表
            if (!found) {
                refreshModelsList();
                // 延迟设置选中项，等待刷新完成
                setTimeout(() => {
                    for (let i = 0; i < modelSelect.options.length; i++) {
                        if (modelSelect.options[i].value === preSelectedModel) {
                            modelSelect.selectedIndex = i;
                            break;
                        }
                    }
                }, 1000);
            }
        }
    });
</script>
{% endblock %}

